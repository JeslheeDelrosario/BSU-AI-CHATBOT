generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AIInteraction {
  id          String            @id @default(cuid())
  userId      String
  type        AIInteractionType
  context     String?
  userMessage String
  aiResponse  String
  helpful     Boolean?
  createdAt   DateTime          @default(now())
  User        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model AccessibilitySettings {
  id                  String   @id @default(cuid())
  userId              String   @unique
  fontSize            Int      @default(16)
  fontFamily          String   @default("Arial")
  highContrast        Boolean  @default(false)
  colorScheme         String   @default("default")
  reducedMotion       Boolean  @default(false)
  textToSpeechEnabled Boolean  @default(false)
  ttsSpeed            Float    @default(1.0)
  ttsVoice            String   @default("default")
  speechToTextEnabled Boolean  @default(false)
  keyboardOnly        Boolean  @default(false)
  captionsEnabled     Boolean  @default(true)
  transcriptsEnabled  Boolean  @default(true)
  signLanguageEnabled Boolean  @default(false)
  language            String   @default("en")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  User                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AchievementDefinition {
  id               String          @id @default(cuid())
  type             AchievementType @unique
  title            String
  description      String
  icon             String
  points           Int             @default(0)
  requirementType  String          // e.g. "COURSE_COMPLETION", "CORRECT_ANSWERS", "QUIZ_SCORE", "STREAK"
  requirementValue Int             // e.g. 5 (courses), 100 (answers), 90 (score %), 7 (days)
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  Achievements     Achievement[]
}

model Achievement {
  id           String                @id @default(cuid())
  userId       String
  type         AchievementType
  title        String
  description  String
  icon         String
  points       Int                   @default(0)
  earnedAt     DateTime              @default(now())
  definitionId String?
  Definition   AchievementDefinition? @relation(fields: [definitionId], references: [id], onDelete: SetNull)
  User         User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([definitionId])
}

model LeaderboardConfig {
  id          String   @id @default(cuid())
  name        String
  metric      String   // "CORRECT_ANSWERS", "COMPLETION_TIME", "COURSE_COMPLETION", "QUIZ_SCORE"
  courseId    String?
  topN        Int      @default(10)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Assessment {
  id               String             @id @default(cuid())
  courseId         String
  lessonId         String?
  title            String
  description      String?
  timeLimit        Int?
  passingScore     Float
  maxAttempts      Int?
  questions        String
  isPublished      Boolean            @default(false)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  AssessmentResult AssessmentResult[]

  @@index([courseId])
}

model AssessmentResult {
  id           String     @id @default(cuid())
  assessmentId String
  userId       String
  score        Float
  answers      String
  timeSpent    Int
  passed       Boolean
  attempt      Int        @default(1)
  completedAt  DateTime   @default(now())
  Assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([assessmentId])
  @@index([userId])
}

model Assignment {
  id                  String         @id @default(cuid())
  courseId            String
  lessonId            String?
  title               String
  description         String
  type                AssignmentType
  maxScore            Float
  dueDate             DateTime?
  allowLateSubmission Boolean        @default(false)
  instructions        String
  rubric              String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  Submission          Submission[]

  @@index([courseId])
}

model ChatSession {
  id            String         @id @default(cuid())
  userId        String
  title         String
  messages      Json           @default("[]")
  isStarred     Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  User          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  PracticeExams PracticeExam[]

  @@index([userId])
  @@index([createdAt])
  @@index([isStarred])
}

model ConsultationBooking {
  id          String              @id @default(cuid())
  facultyId   String
  studentId   String
  date        DateTime
  startTime   String
  endTime     String
  topic       String
  notes       String?
  status      ConsultationStatus  @default(PENDING)
  meetingLink String?
  location    String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  Faculty     Faculty             @relation(fields: [facultyId], references: [id], onDelete: Cascade)
  Student     User                @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([facultyId])
  @@index([studentId])
  @@index([date])
  @@index([status])
}

enum ConsultationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  RESCHEDULED
}

model Course {
  id                          String         @id @default(cuid())
  title                       String
  description                 String
  thumbnail                   String?
  level                       CourseLevel
  status                      CourseStatus   @default(DRAFT)
  duration                    Int?
  price                       Float?         @default(0)
  tags                        String[]
  creatorId                   String
  teacherId                   String?
  createdAt                   DateTime       @default(now())
  updatedAt                   DateTime       @updatedAt
  User_Course_creatorIdToUser User           @relation("Course_creatorIdToUser", fields: [creatorId], references: [id])
  User_Course_teacherIdToUser User?          @relation("Course_teacherIdToUser", fields: [teacherId], references: [id])
  CourseReview                CourseReview[]
  Enrollment                  Enrollment[]
  Lesson                      Lesson[]
  Classrooms                  Classroom[]
  modules Module[]  @relation("CourseModules")

  @@index([creatorId])
  @@index([status])
  @@index([teacherId])
}

model CourseReview {
  id        String   @id @default(cuid())
  courseId  String
  userId    String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@index([courseId])
  @@index([userId])
}

model CurriculumEntry {
  id                String            @id @default(cuid())
  programId         String
  yearLevel         Int
  semester          Int
  courseCode        String
  subjectName       String
  lec               Int               @default(0)
  lab               Int               @default(0)
  totalUnits        Int               @default(0)
  lecHours          Int               @default(0)
  labHours          Int               @default(0)
  totalHours        Int               @default(0)
  prerequisites     String[]          @default([])
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  UniversityProgram UniversityProgram @relation(fields: [programId], references: [id])
}

model Enrollment {
  id             String           @id @default(cuid())
  userId         String
  courseId       String
  status         EnrollmentStatus @default(ACTIVE)
  progress       Float            @default(0)
  enrolledAt     DateTime         @default(now())
  completedAt    DateTime?
  lastAccessedAt DateTime?
  droppedAt      DateTime?

  Course         Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  User           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([courseId])
  @@index([userId])
}

model FAQ {
  id          String   @id @default(cuid())
  category    String
  question    String
  answer      String
  keywords    String[]
  viewCount   Int      @default(0)
  helpful     Int      @default(0)
  notHelpful  Int      @default(0)
  isPublished Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([isPublished])
  @@index([isPublished, category])
  @@index([isPublished, helpful(sort: Desc), viewCount(sort: Desc)])
  @@index([keywords], type: Gin) // GIN index for array contains queries
}

model Faculty {
  id                   String                 @id @default(cuid())
  firstName            String
  middleName           String?
  lastName             String
  email                String?
  position             String
  college              String                 @default("College of Science")
  officeHours          String?
  consultationDays     String[]               @default([])
  consultationStart    String?
  consultationEnd      String?
  vacantTime           String?
  FacultySchedule      FacultySchedule[]
  FacultySubject       FacultySubject[]
  ConsultationBookings ConsultationBooking[]
}

model FacultySchedule {
  id           String  @id @default(cuid())
  facultyId    String
  dayOfWeek    String
  startTime    String
  endTime      String
  subject      String?
  room         String?
  scheduleType String  @default("CLASS")
  Faculty      Faculty @relation(fields: [facultyId], references: [id], onDelete: Cascade)

  @@index([facultyId])
}

model FacultySubject {
  id        String  @id @default(cuid())
  facultyId String
  subjectId String
  Faculty   Faculty @relation(fields: [facultyId], references: [id])
  Subject   Subject @relation(fields: [subjectId], references: [id])
}

model GroupMessage {
  id          String     @id @default(cuid())
  groupId     String
  userId      String
  content     String
  attachments String[]
  createdAt   DateTime   @default(now())
  StudyGroup  StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([groupId])
}

model Lesson {
  id          String     @id @default(cuid())
  courseId    String
  title       String
  description String?
  type        LessonType
  content     String
  videoUrl    String?
  audioUrl    String?
  transcript  String?
  duration    Int?
  order       Int
  isPublished Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  Course      Course     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  Progress    Progress[]
  Resource    Resource[]
  moduleId String?
  module   Module? @relation(fields: [moduleId], references: [id])


  @@index([courseId])
  @@index([order])
}

model Message {
  id                            String   @id @default(cuid())
  senderId                      String
  receiverId                    String
  subject                       String?
  content                       String
  isRead                        Boolean  @default(false)
  createdAt                     DateTime @default(now())
  User_Message_receiverIdToUser User     @relation("Message_receiverIdToUser", fields: [receiverId], references: [id], onDelete: Cascade)
  User_Message_senderIdToUser   User     @relation("Message_senderIdToUser", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([receiverId])
  @@index([senderId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String   // NEW_POST, NEW_COMMENT, ROLE_ASSIGNED, etc.
  link      String?
  metadata  Json?    // Additional data (classroomId, postId, etc.)
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
  @@index([type])
}

model Progress {
  id           String    @id @default(cuid())
  userId       String
  lessonId     String
  completed    Boolean   @default(false)
  timeSpent    Int       @default(0)
  lastPosition Int?
  attempts     Int       @default(0)
  score        Float?
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  updatedAt    DateTime  @updatedAt
  Lesson       Lesson    @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  User         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
  @@index([lessonId])
  @@index([userId])
}

model Resource {
  id        String   @id @default(cuid())
  lessonId  String
  title     String
  type      String
  url       String
  size      Int?
  createdAt DateTime @default(now())
  Lesson    Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}

model StudyGroup {
  id               String             @id @default(cuid())
  name             String
  description      String?
  courseId         String?
  maxMembers       Int                @default(10)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  GroupMessage     GroupMessage[]
  StudyGroupMember StudyGroupMember[]
}

model StudyGroupMember {
  id         String     @id @default(cuid())
  groupId    String
  userId     String
  role       String     @default("member")
  joinedAt   DateTime   @default(now())
  StudyGroup StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  User       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
}

model Subject {
  id             String           @id @default(cuid())
  code           String
  name           String
  program        String?
  FacultySubject FacultySubject[]

  @@index([program])
}

model Submission {
  id           String           @id @default(cuid())
  assignmentId String
  userId       String
  content      String
  attachments  String[]
  status       SubmissionStatus @default(DRAFT)
  score        Float?
  feedback     String?
  gradedBy     String?
  gradedAt     DateTime?
  submittedAt  DateTime?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  Assignment   Assignment       @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  User         User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([assignmentId, userId])
  @@index([assignmentId])
  @@index([userId])
}

model UniversityProgram {
  id              String            @id @default(cuid())
  title           String            @unique
  abbreviation    String?
  college         String
  description     String?
  careerPaths     String[]          @default([])
  isActive        Boolean           @default(true)
  order           Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  CurriculumEntry CurriculumEntry[]

  @@index([college])
  @@index([isActive])
}

model User {
  id                               String                 @id @default(cuid())
  email                            String                 @unique
  password                         String
  firstName                        String
  lastName                         String
  role                             UserRole               @default(STUDENT)
  avatar                           String?
  phoneNumber                      String?
  course                           String?
  section                          String?
  isActive                         Boolean                @default(true)
  createdAt                        DateTime               @default(now())
  updatedAt                        DateTime               @updatedAt
  learningStyle                    LearningStyle?
  gradeLevel                       String?
  dateOfBirth                      DateTime?
  parentId                         String?
  AIInteraction                    AIInteraction[]
  AccessibilitySettings            AccessibilitySettings?
  Achievement                      Achievement[]
  AssessmentResult                 AssessmentResult[]
  ChatSession                      ChatSession[]
  enrolledCoursesCount Int         @default(0)
  Course_Course_creatorIdToUser    Course[]               @relation("Course_creatorIdToUser")
  Course_Course_teacherIdToUser    Course[]               @relation("Course_teacherIdToUser")
  CourseReview                     CourseReview[]
  Enrollment                       Enrollment[]
  Message_Message_receiverIdToUser Message[]              @relation("Message_receiverIdToUser")
  Message_Message_senderIdToUser   Message[]              @relation("Message_senderIdToUser")
  Notification                     Notification[]
  Progress                         Progress[]
  StudyGroupMember                 StudyGroupMember[]
  Submission                       Submission[]
  ConsultationBookings             ConsultationBooking[]
  ClassroomMembers                 ClassroomMember[]
  ClassroomPosts                   ClassroomPost[]        @relation("ClassroomPostAuthor")
  ClassroomComments                ClassroomComment[]     @relation("ClassroomCommentAuthor")
  PostReactions                    PostReaction[]         @relation("PostReactionUser")
  CommentReactions                 CommentReaction[]      @relation("CommentReactionUser")
  AssignmentSubmissions            AssignmentSubmission[] @relation("AssignmentSubmissionStudent")
  ClassroomJoinRequests            ClassroomJoinRequest[] @relation("JoinRequestUser")
  ReviewedJoinRequests             ClassroomJoinRequest[] @relation("JoinRequestReviewer")
  User                             User?                  @relation("UserToUser", fields: [parentId], references: [id])
  other_User                       User[]                 @relation("UserToUser")
  userModuleProgresses             UserModuleProgress[]   @relation("UserModuleProgresses")
  OrganizedMeetings                Meeting[]              @relation("MeetingOrganizer")
  MeetingParticipations            MeetingParticipant[]   @relation("MeetingParticipants")
  createdClassroomMeetings         ClassroomMeeting[]     @relation("ClassroomMeetingCreator")
  classroomMeetingAttendances      ClassroomMeetingAttendee[] @relation("ClassroomMeetingAttendees")
  googleAccessToken                String?
  googleRefreshToken               String?
  googleTokenExpiry                DateTime?
  PracticeExams                    PracticeExam[]
  PracticeExamResults              PracticeExamResult[]
  CalendarPreference               CalendarPreference?
  CalendarVisibilities             CalendarVisibility[]
  Tasks                            Task[]
  SSOLinks                         UserSSOLink[]
  // Forum relations
  CreatedCommunities               Community[]            @relation("CommunityCreator")
  CommunityMemberships             CommunityMember[]      @relation("CommunityMemberships")
  CommunityJoinRequests            CommunityJoinRequest[] @relation("CommunityJoinRequests")
  CommunityJoinReviews             CommunityJoinRequest[] @relation("CommunityJoinReviewer")
  CommunityInvitesSent             CommunityInvitation[]  @relation("CommunityInviter")
  CommunityInvitesReceived         CommunityInvitation[]  @relation("CommunityInvitee")
  ForumPosts                       ForumPost[]            @relation("ForumPostAuthor")
  ForumComments                    ForumComment[]         @relation("ForumCommentAuthor")
  ForumPostReactions               ForumPostReaction[]    @relation("ForumPostReactions")
  ForumCommentReactions            ForumCommentReaction[] @relation("ForumCommentReactions")
  ForumBookmarks                   ForumBookmark[]        @relation("ForumBookmarks")
  ForumPollVotes                   ForumPollVote[]        @relation("ForumPollVotes")
  ForumReports                     ForumReport[]          @relation("ForumReporter")
  ForumReportReviews               ForumReport[]          @relation("ForumReportReviewer")
  RoomChatMessages                 RoomChatMessage[]

  @@index([email])
  @@index([role])
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}

enum AIInteractionType {
  QUESTION
  EXPLANATION
  EXAMPLE
  HINT
  FEEDBACK
  TRANSLATION
  SUMMARY
}

enum AchievementType {
  COURSE_COMPLETION
  STREAK
  PERFECT_SCORE
  EARLY_BIRD
  NIGHT_OWL
  HELPFUL_PEER
  MILESTONE
  FIRST_COURSE
  FIVE_COURSES
  TEN_COURSES
  QUIZ_MASTER
  SPEED_LEARNER
  CORRECT_ANSWERS_100
  CORRECT_ANSWERS_500
  MODULE_COMPLETE
  LEADERBOARD_TOP3
  LEADERBOARD_TOP1
  DEDICATED_LEARNER
  RANK_NEWCOMER
  RANK_LEARNER
  RANK_EXPLORER
  RANK_ACHIEVER
  RANK_SCHOLAR
  RANK_EXPERT
  RANK_MASTER_SCHOLAR
}

enum AssignmentType {
  ESSAY
  MULTIPLE_CHOICE
  SHORT_ANSWER
  PROJECT
  CODING
  PRESENTATION
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum CourseStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum EnrollmentStatus {
  ACTIVE
  COMPLETED
  DROPPED
  PAUSED
}

enum LearningStyle {
  VISUAL
  AUDITORY
  KINESTHETIC
  READING_WRITING
  MIXED
}

enum LessonType {
  VIDEO
  TEXT
  AUDIO
  INTERACTIVE
  QUIZ
  ASSIGNMENT
}

enum SubmissionStatus {
  DRAFT
  SUBMITTED
  GRADED
  RETURNED
}

enum UserRole {
  STUDENT
  TEACHER
  PARENT
  ADMIN
  CONTENT_CREATOR
}

// ============================================
// CLASSROOM SYSTEM MODELS
// ============================================

model Classroom {
  id              String            @id @default(cuid())
  courseId        String
  name            String
  section         String?
  sections        String?           // Additional sections info for About page
  description     String?
  inviteCode      String            @unique @default(cuid())
  isArchived      Boolean           @default(false)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  Course          Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  ClassroomPosts  ClassroomPost[]
  ClassroomMembers      ClassroomMember[]
  ClassroomJoinRequests ClassroomJoinRequest[]
  ClassroomMeetings     ClassroomMeeting[]
  Tasks                 Task[]
  
  @@index([courseId])
  @@index([inviteCode])
  @@index([isArchived])
}

model ClassroomMember {
  id          String          @id @default(cuid())
  classroomId String
  userId      String
  role        ClassroomRole   @default(STUDENT)
  joinedAt    DateTime        @default(now())
  lastSeenAt  DateTime?
  Classroom   Classroom       @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  User        User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([classroomId, userId])
  @@index([classroomId])
  @@index([userId])
}

enum ClassroomRole {
  TEACHER
  STUDENT
  PRESIDENT      // Student with posting privileges
  VICE_PRESIDENT // Student with posting privileges
  MODERATOR      // Student with posting privileges
  TA
}

model ClassroomJoinRequest {
  id          String              @id @default(cuid())
  classroomId String
  userId      String
  status      JoinRequestStatus   @default(PENDING)
  message     String?             // Optional message from student
  attachments String[]            @default([]) // File URLs (PDF/DOCX proof of enrollment)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  reviewedBy  String?             // Teacher who approved/rejected
  reviewedAt  DateTime?
  Classroom   Classroom           @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  User        User                @relation("JoinRequestUser", fields: [userId], references: [id], onDelete: Cascade)
  Reviewer    User?               @relation("JoinRequestReviewer", fields: [reviewedBy], references: [id])
  
  @@unique([classroomId, userId])
  @@index([classroomId])
  @@index([userId])
  @@index([status])
}

enum JoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model ClassroomPost {
  id              String              @id @default(cuid())
  classroomId     String
  authorId        String
  type            PostType
  title           String?
  content         String
  attachments     Json                @default("[]")
  images          String[]            @default([])
  isPinned        Boolean             @default(false)
  visibility      PostVisibility      @default(ALL_STUDENTS)
  publishedAt     DateTime            @default(now())
  dueDate         DateTime?
  points          Int?
  allowLateSubmission Boolean         @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  Classroom       Classroom           @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  Author          User                @relation("ClassroomPostAuthor", fields: [authorId], references: [id])
  Comments        ClassroomComment[]
  Submissions     AssignmentSubmission[]
  Reactions       PostReaction[]
  
  @@index([classroomId])
  @@index([authorId])
  @@index([type])
  @@index([publishedAt])
  @@index([dueDate])
}

enum PostVisibility {
  ALL_STUDENTS
  MODERATORS_ONLY
}

enum PostType {
  ANNOUNCEMENT
  MATERIAL
  DISCUSSION
  
  // Major Academic Work
  PROJECT
  CAPSTONE_PROJECT
  THESIS
  RESEARCH_PAPER
  CASE_STUDY
  FEASIBILITY_STUDY
  PROPOSAL
  
  // Coursework & Submissions
  ASSIGNMENT
  HOMEWORK
  SEATWORK
  WORKSHEET
  WRITTEN_EXERCISE
  PRACTICE_TASK
  
  // Activities
  ACTIVITY
  CLASS_ACTIVITY
  GROUP_ACTIVITY
  INDIVIDUAL_ACTIVITY
  LABORATORY_ACTIVITY
  HANDS_ON_ACTIVITY
  WORKSHOP_ACTIVITY
  
  // Assessments
  QUIZ
  SHORT_QUIZ
  LONG_QUIZ
  PRE_TEST
  POST_TEST
  EXAMINATION
  MIDTERM_EXAM
  FINAL_EXAM
  PRACTICAL_EXAM
  
  // Collaboration & Participation
  GROUP_WORK
  PAIR_WORK
  TEAM_TASK
  DISCUSSION_TASK
  RECITATION
  PARTICIPATION_TASK
  
  // Output & Presentations
  PRESENTATION
  ORAL_PRESENTATION
  VIDEO_PRESENTATION
  POSTER
  PORTFOLIO
  CREATIVE_OUTPUT
  
  // Reflection & Evaluation
  REFLECTION_PAPER
  LEARNING_JOURNAL
  SELF_ASSESSMENT
  PEER_EVALUATION
  FEEDBACK
  
  // Online / Submission-Based
  ONLINE_ACTIVITY
  ONLINE_SUBMISSION
  FORUM_POST
  DISCUSSION_BOARD_RESPONSE
  
  // Practicum / Experience-Based
  INTERNSHIP_REQUIREMENT
  OJT_REQUIREMENT
  PRACTICUM_ACTIVITY
  FIELD_STUDY
  OBSERVATION_REPORT
}

model ClassroomComment {
  id          String            @id @default(cuid())
  postId      String
  authorId    String
  parentId    String?
  content     String
  attachments Json              @default("[]")
  isPrivate   Boolean           @default(false)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  Post        ClassroomPost     @relation(fields: [postId], references: [id], onDelete: Cascade)
  Author      User              @relation("ClassroomCommentAuthor", fields: [authorId], references: [id])
  Parent      ClassroomComment? @relation("CommentReplies", fields: [parentId], references: [id])
  Replies     ClassroomComment[] @relation("CommentReplies")
  Reactions   CommentReaction[]
  
  @@index([postId])
  @@index([authorId])
  @@index([parentId])
  @@index([createdAt])
}

model PostReaction {
  id        String        @id @default(cuid())
  postId    String
  userId    String
  emoji     String
  createdAt DateTime      @default(now())
  Post      ClassroomPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  User      User          @relation("PostReactionUser", fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([postId, userId, emoji])
  @@index([postId])
}

model CommentReaction {
  id        String           @id @default(cuid())
  commentId String
  userId    String
  emoji     String
  createdAt DateTime         @default(now())
  Comment   ClassroomComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  User      User             @relation("CommentReactionUser", fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([commentId, userId, emoji])
  @@index([commentId])
}

model AssignmentSubmission {
  id              String              @id @default(cuid())
  assignmentId    String
  studentId       String
  content         String?
  attachments     Json                @default("[]")
  status          SubmissionStatus    @default(DRAFT)
  submittedAt     DateTime?
  grade           Float?
  feedback        String?
  isLate          Boolean             @default(false)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  Assignment      ClassroomPost       @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  Student         User                @relation("AssignmentSubmissionStudent", fields: [studentId], references: [id])
  
  @@unique([assignmentId, studentId])
  @@index([assignmentId])
  @@index([studentId])
  @@index([status])
}

model Module {
  id          String   @id @default(cuid())
  title       String
  description String?
  order       Int
  courseId    String

  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade, name: "CourseModules")
  lessons     Lesson[]
  quiz        Quiz?
  progresses  UserModuleProgress[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Quiz {
  id           String   @id @default(cuid())
  moduleId     String   @unique
  passingScore Int      @default(70)

  module       Module   @relation(fields: [moduleId], references: [id])
  questions    Question[]

  createdAt    DateTime @default(now())
}

model Question {
  id        String   @id @default(cuid())
  quizId    String
  text      String
  type      QuestionType

  quiz      Quiz     @relation(fields: [quizId], references: [id])
  answers   Answer[]

  createdAt DateTime @default(now())
}

model Answer {
  id          String   @id @default(cuid())
  questionId  String
  text        String
  isCorrect   Boolean @default(false)

  question    Question @relation(fields: [questionId], references: [id])
}

model UserModuleProgress {
  id         String   @id @default(cuid())
  userId     String
  moduleId   String
  completed  Boolean  @default(false)
  score      Int?
  completedAt DateTime?

  module Module @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, name: "UserModuleProgresses")

  @@unique([userId, moduleId])
}


enum QuestionType {
  MCQ
  TRUE_FALSE
  MULTIPLE_CHOICE
}

// ============================================
// ROOM & MEETING MANAGEMENT MODELS
// ============================================

model Room {
  id          String   @id @default(cuid())
  name        String
  building    String
  floor       Int?
  capacity    Int
  type        RoomType @default(CLASSROOM)
  facilities  String[] @default([])
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  Meetings    Meeting[]
  Layout      RoomLayout?
  ChatMessages RoomChatMessage[]
  
  @@unique([name, building])
  @@index([building])
  @@index([type])
  @@index([isActive])
}

// Room Layout Configuration for 3D Floor Plan
model RoomLayout {
  id              String   @id @default(cuid())
  roomId          String   @unique
  width           Int      @default(600)
  height          Int      @default(400)
  wallColor       String   @default("#1e293b")
  floorColor      String   @default("#0f172a")
  floorPattern    String   @default("grid")
  backgroundSound String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  Room            Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  Furniture       RoomFurniture[]
  
  @@index([roomId])
}

// Furniture and Items in Room
model RoomFurniture {
  id          String   @id @default(cuid())
  layoutId    String
  type        FurnitureType
  name        String
  x           Float
  y           Float
  width       Float
  height      Float
  rotation    Float    @default(0)
  color       String?
  zIndex      Int      @default(1)
  isLocked    Boolean  @default(false)
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  Layout      RoomLayout @relation(fields: [layoutId], references: [id], onDelete: Cascade)
  
  @@index([layoutId])
  @@index([type])
}

enum FurnitureType {
  CHAIR
  TABLE
  DESK
  WHITEBOARD
  PROJECTOR_SCREEN
  COMPUTER
  BOOKSHELF
  DOOR
  WINDOW
  PODIUM
  CABINET
  PLANT
  CLOCK
  BOARD
  CUSTOM
}

// Room Chat Messages for Persistence
model RoomChatMessage {
  id        String   @id @default(cuid())
  roomId    String
  userId    String?
  sender    String
  message   String
  isSystem  Boolean  @default(false)
  createdAt DateTime @default(now())
  Room      Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  User      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  @@index([roomId])
  @@index([userId])
  @@index([createdAt])
}

enum RoomType {
  CLASSROOM
  LABORATORY
  CONFERENCE
  LECTURE_HALL
  COMPUTER_LAB
  LIBRARY
  STUDY_ROOM
  AUDITORIUM
}

model Meeting {
  id              String        @id @default(cuid())
  title           String
  description     String?
  organizerId     String
  roomId          String?
  meetingType     MeetingType
  googleMeetLink  String?
  startTime       DateTime
  endTime         DateTime
  isRecurring     Boolean       @default(false)
  recurrenceRule  String?
  status          MeetingStatus @default(SCHEDULED)
  maxParticipants Int?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  Organizer       User          @relation("MeetingOrganizer", fields: [organizerId], references: [id], onDelete: Cascade)
  Room            Room?         @relation(fields: [roomId], references: [id])
  Participants    MeetingParticipant[]
  
  @@index([organizerId])
  @@index([roomId])
  @@index([startTime])
  @@index([endTime])
  @@index([status])
  @@index([meetingType])
}

enum MeetingType {
  ONLINE
  IN_PERSON
  HYBRID
  CONSULTATION
  CLASS
  EXAM
  WORKSHOP
  SEMINAR
}

enum MeetingStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

model MeetingParticipant {
  id         String              @id @default(cuid())
  meetingId  String
  userId     String
  role       ParticipantRole     @default(ATTENDEE)
  status     ParticipantStatus   @default(INVITED)
  joinedAt   DateTime?
  leftAt     DateTime?
  createdAt  DateTime            @default(now())
  Meeting    Meeting             @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  User       User                @relation("MeetingParticipants", fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([meetingId, userId])
  @@index([meetingId])
  @@index([userId])
  @@index([status])
}

enum ParticipantRole {
  ORGANIZER
  CO_ORGANIZER
  PRESENTER
  ATTENDEE
}

enum ParticipantStatus {
  INVITED
  ACCEPTED
  DECLINED
  ATTENDED
  ABSENT
}

// Classroom Meeting Management
model ClassroomMeeting {
  id                    String                    @id @default(cuid())
  classroomId           String
  title                 String
  description           String?
  meetingType           ClassroomMeetingType      @default(LECTURE)
  googleMeetLink        String
  googleCalendarEventId String?
  startTime             DateTime
  endTime               DateTime
  status                ClassroomMeetingStatus    @default(SCHEDULED)
  createdById           String
  isRecurring           Boolean                   @default(false)
  recurrenceRule        String?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  
  Classroom       Classroom                 @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  CreatedBy       User                      @relation("ClassroomMeetingCreator", fields: [createdById], references: [id])
  Attendees       ClassroomMeetingAttendee[]
  
  @@index([classroomId])
  @@index([startTime])
  @@index([status])
  @@index([createdById])
}

model ClassroomMeetingAttendee {
  id              String                    @id @default(cuid())
  meetingId       String
  userId          String
  status          AttendeeStatus            @default(INVITED)
  joinedAt        DateTime?
  leftAt          DateTime?
  createdAt       DateTime                  @default(now())
  
  Meeting         ClassroomMeeting          @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  User            User                      @relation("ClassroomMeetingAttendees", fields: [userId], references: [id])
  
  @@unique([meetingId, userId])
  @@index([meetingId])
  @@index([userId])
  @@index([status])
}

enum ClassroomMeetingType {
  LECTURE
  LAB_SESSION
  DISCUSSION
  EXAM
  QUIZ
  OFFICE_HOURS
  REVIEW_SESSION
  WORKSHOP
  SEMINAR
  GROUP_WORK
}

enum ClassroomMeetingStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum AttendeeStatus {
  INVITED
  ACCEPTED
  DECLINED
  ATTENDED
  ABSENT
}

model PracticeExam {
  id              String        @id @default(cuid())
  userId          String
  title           String
  description     String?
  subject         String
  difficulty      String
  totalQuestions  Int
  estimatedTime   Int           // in minutes
  questions       Json          // Array of quiz questions
  chatSessionId   String?
  completedAt     DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  User            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  ChatSession     ChatSession?  @relation(fields: [chatSessionId], references: [id], onDelete: SetNull)
  Results         PracticeExamResult[]

  @@index([userId])
  @@index([chatSessionId])
  @@index([createdAt])
}

model PracticeExamResult {
  id              String        @id @default(cuid())
  examId          String
  userId          String
  score           Int           // percentage
  correctAnswers  Int
  incorrectAnswers Int
  passed          Boolean
  timeSpent       Int?          // in seconds
  answers         Json          // User's answers
  detailedResults Json          // Detailed results per question
  createdAt       DateTime      @default(now())
  Exam            PracticeExam  @relation(fields: [examId], references: [id], onDelete: Cascade)
  User            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([examId])
  @@index([userId])
  @@index([createdAt])
}

// ============================================
// CALENDAR PREFERENCES & VISIBILITY
// ============================================

model CalendarPreference {
  id        String           @id @default(cuid())
  userId    String           @unique
  viewType  CalendarViewType @default(MONTH)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  User      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum CalendarViewType {
  DAY
  WEEK
  MONTH
  YEAR
  SCHEDULE
  HOLIDAY
  WEATHER
}

model CalendarVisibility {
  id           String   @id @default(cuid())
  userId       String
  calendarType String
  calendarId   String?
  isVisible    Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, calendarType, calendarId])
  @@index([userId])
}

// ============================================
// HOLIDAYS
// ============================================

model Holiday {
  id          String      @id @default(cuid())
  name        String
  date        DateTime
  type        HolidayType
  region      String
  description String?
  isRecurring Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([date])
  @@index([region])
  @@index([type])
}

enum HolidayType {
  NATIONAL
  REGIONAL
  LOCAL
  SPECIAL_NON_WORKING
  REGULAR_HOLIDAY
}

// ============================================
// TASKS
// ============================================

model Task {
  id          String       @id @default(cuid())
  userId      String
  classroomId String?
  title       String
  description String?
  priority    TaskPriority @default(MEDIUM)
  status      TaskStatus   @default(TODO)
  dueDate     DateTime?
  category    TaskCategory @default(PERSONAL)
  tags        String[]
  completedAt DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  User        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  Classroom   Classroom?   @relation(fields: [classroomId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([classroomId])
  @@index([status])
  @@index([dueDate])
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TaskCategory {
  PERSONAL
  ACADEMIC
  ASSIGNMENT
  PROJECT
  EXAM_PREP
  MEETING_PREP
  OTHER
}

// ============================================
// WEATHER CACHE
// ============================================

model WeatherCache {
  id        String   @id @default(cuid())
  location  String
  data      Json
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([location])
  @@index([expiresAt])
}

// ============================================
// SSO PROVIDERS
// ============================================

model SSOProvider {
  id            String        @id @default(cuid())
  name          String        @unique
  clientId      String
  clientSecret  String
  authUrl       String
  tokenUrl      String
  userInfoUrl   String
  redirectUrl   String
  scope         String
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  UserSSOLinks  UserSSOLink[]
}

model UserSSOLink {
  id           String       @id @default(cuid())
  userId       String
  provider     String
  providerId   String
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  User         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  SSOProvider  SSOProvider? @relation(fields: [provider], references: [name])

  @@unique([provider, providerId])
  @@index([userId])
  @@index([provider])
}

// ============================================
// FORUMS & COMMUNITY SYSTEM
// ============================================

model Community {
  id              String              @id @default(cuid())
  name            String
  slug            String              @unique
  description     String?
  coverImage      String?
  avatar          String?
  visibility      CommunityVisibility @default(PUBLIC)
  joinPolicy      CommunityJoinPolicy @default(OPEN)
  creatorId       String
  isVerified      Boolean             @default(false)
  isArchived      Boolean             @default(false)
  memberCount     Int                 @default(0)
  postCount       Int                 @default(0)
  tags            String[]            @default([])
  guidelines      String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  Creator         User                @relation("CommunityCreator", fields: [creatorId], references: [id])
  Members         CommunityMember[]
  Posts           ForumPost[]
  JoinRequests    CommunityJoinRequest[]
  Permissions     CommunityPermission[]
  Categories      ForumCategory[]
  Invitations     CommunityInvitation[]

  @@index([creatorId])
  @@index([visibility])
  @@index([slug])
  @@index([isArchived])
}

enum CommunityVisibility {
  PUBLIC          // Anyone can see posts
  PRIVATE         // Only members can see posts
  HIDDEN          // Community not discoverable, invite-only
}

enum CommunityJoinPolicy {
  OPEN            // Anyone can join
  APPROVAL        // Requires admin approval
  INVITE_ONLY     // Only invited users can join
}

model CommunityMember {
  id          String              @id @default(cuid())
  communityId String
  userId      String
  role        CommunityMemberRole @default(MEMBER)
  joinedAt    DateTime            @default(now())
  mutedUntil  DateTime?
  bannedAt    DateTime?
  banReason   String?
  Community   Community           @relation(fields: [communityId], references: [id], onDelete: Cascade)
  User        User                @relation("CommunityMemberships", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([communityId, userId])
  @@index([communityId])
  @@index([userId])
  @@index([role])
}

enum CommunityMemberRole {
  OWNER           // Full control, can delete community
  ADMIN           // Can manage members, posts, settings
  MODERATOR       // Can moderate posts and comments
  MEMBER          // Can post and comment (based on permissions)
}

model CommunityJoinRequest {
  id          String                    @id @default(cuid())
  communityId String
  userId      String
  status      CommunityJoinRequestStatus @default(PENDING)
  message     String?
  reviewedBy  String?
  reviewedAt  DateTime?
  reviewNote  String?
  createdAt   DateTime                  @default(now())
  Community   Community                 @relation(fields: [communityId], references: [id], onDelete: Cascade)
  User        User                      @relation("CommunityJoinRequests", fields: [userId], references: [id], onDelete: Cascade)
  Reviewer    User?                     @relation("CommunityJoinReviewer", fields: [reviewedBy], references: [id])

  @@unique([communityId, userId])
  @@index([communityId])
  @@index([userId])
  @@index([status])
}

enum CommunityJoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model CommunityInvitation {
  id          String                    @id @default(cuid())
  communityId String
  inviterId   String
  inviteeId   String?
  email       String?
  token       String                    @unique @default(cuid())
  status      CommunityInvitationStatus @default(PENDING)
  expiresAt   DateTime
  createdAt   DateTime                  @default(now())
  Community   Community                 @relation(fields: [communityId], references: [id], onDelete: Cascade)
  Inviter     User                      @relation("CommunityInviter", fields: [inviterId], references: [id])
  Invitee     User?                     @relation("CommunityInvitee", fields: [inviteeId], references: [id])

  @@index([communityId])
  @@index([inviterId])
  @@index([inviteeId])
  @@index([token])
  @@index([status])
}

enum CommunityInvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
  EXPIRED
}

model CommunityPermission {
  id              String    @id @default(cuid())
  communityId     String
  role            CommunityMemberRole
  canPost         Boolean   @default(true)
  canComment      Boolean   @default(true)
  canReact        Boolean   @default(true)
  canShare        Boolean   @default(true)
  canUploadMedia  Boolean   @default(true)
  canCreatePolls  Boolean   @default(false)
  canPinPosts     Boolean   @default(false)
  canModerate     Boolean   @default(false)
  canInvite       Boolean   @default(false)
  canManageMembers Boolean  @default(false)
  canEditSettings Boolean   @default(false)
  Community       Community @relation(fields: [communityId], references: [id], onDelete: Cascade)

  @@unique([communityId, role])
  @@index([communityId])
}

model ForumCategory {
  id          String      @id @default(cuid())
  communityId String?
  name        String
  slug        String
  description String?
  icon        String?
  color       String?
  order       Int         @default(0)
  isDefault   Boolean     @default(false)
  createdAt   DateTime    @default(now())
  Community   Community?  @relation(fields: [communityId], references: [id], onDelete: Cascade)
  Posts       ForumPost[]

  @@unique([communityId, slug])
  @@index([communityId])
  @@index([order])
}

model ForumPost {
  id              String              @id @default(cuid())
  communityId     String?
  categoryId      String?
  authorId        String
  title           String
  content         String
  contentHtml     String?
  slug            String
  type            ForumPostType       @default(DISCUSSION)
  visibility      ForumPostVisibility @default(PUBLIC)
  status          ForumPostStatus     @default(PUBLISHED)
  isPinned        Boolean             @default(false)
  isLocked        Boolean             @default(false)
  isFeatured      Boolean             @default(false)
  viewCount       Int                 @default(0)
  likeCount       Int                 @default(0)
  commentCount    Int                 @default(0)
  shareCount      Int                 @default(0)
  tags            String[]            @default([])
  publishedAt     DateTime?
  editedAt        DateTime?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  Community       Community?          @relation(fields: [communityId], references: [id], onDelete: Cascade)
  Category        ForumCategory?      @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  Author          User                @relation("ForumPostAuthor", fields: [authorId], references: [id])
  Media           ForumPostMedia[]
  Comments        ForumComment[]
  Reactions       ForumPostReaction[]
  Bookmarks       ForumBookmark[]
  Reports         ForumReport[]       @relation("ReportedPost")
  Poll            ForumPoll?

  @@unique([communityId, slug])
  @@index([communityId])
  @@index([categoryId])
  @@index([authorId])
  @@index([status])
  @@index([visibility])
  @@index([isPinned])
  @@index([createdAt])
  @@index([publishedAt])
}

enum ForumPostType {
  DISCUSSION
  QUESTION
  ANNOUNCEMENT
  POLL
  MEDIA
  LINK
  EVENT
}

enum ForumPostVisibility {
  PUBLIC          // Anyone can see
  MEMBERS_ONLY    // Only community members
  RESTRICTED      // Specific roles only
}

enum ForumPostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
  REMOVED
  PENDING_REVIEW
}

model ForumPostMedia {
  id          String        @id @default(cuid())
  postId      String
  type        MediaType
  url         String
  thumbnailUrl String?
  filename    String?
  mimeType    String?
  size        Int?
  width       Int?
  height      Int?
  duration    Int?
  caption     String?
  order       Int           @default(0)
  createdAt   DateTime      @default(now())
  Post        ForumPost     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([type])
}

enum MediaType {
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  EMBED
}

model ForumComment {
  id          String              @id @default(cuid())
  postId      String
  authorId    String
  parentId    String?
  content     String
  contentHtml String?
  isEdited    Boolean             @default(false)
  isPinned    Boolean             @default(false)
  likeCount   Int                 @default(0)
  replyCount  Int                 @default(0)
  status      ForumCommentStatus  @default(VISIBLE)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  Post        ForumPost           @relation(fields: [postId], references: [id], onDelete: Cascade)
  Author      User                @relation("ForumCommentAuthor", fields: [authorId], references: [id])
  Parent      ForumComment?       @relation("CommentThread", fields: [parentId], references: [id])
  Replies     ForumComment[]      @relation("CommentThread")
  Reactions   ForumCommentReaction[]
  Reports     ForumReport[]       @relation("ReportedComment")
  Media       ForumCommentMedia[]

  @@index([postId])
  @@index([authorId])
  @@index([parentId])
  @@index([createdAt])
  @@index([status])
}

enum ForumCommentStatus {
  VISIBLE
  HIDDEN
  REMOVED
  PENDING_REVIEW
}

model ForumCommentMedia {
  id          String        @id @default(cuid())
  commentId   String
  type        MediaType
  url         String
  thumbnailUrl String?
  filename    String?
  mimeType    String?
  size        Int?
  createdAt   DateTime      @default(now())
  Comment     ForumComment  @relation(fields: [commentId], references: [id], onDelete: Cascade)

  @@index([commentId])
}

model ForumPostReaction {
  id        String      @id @default(cuid())
  postId    String
  userId    String
  type      ReactionType
  createdAt DateTime    @default(now())
  Post      ForumPost   @relation(fields: [postId], references: [id], onDelete: Cascade)
  User      User        @relation("ForumPostReactions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId, type])
  @@index([postId])
  @@index([userId])
}

model ForumCommentReaction {
  id        String        @id @default(cuid())
  commentId String
  userId    String
  type      ReactionType
  createdAt DateTime      @default(now())
  Comment   ForumComment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
  User      User          @relation("ForumCommentReactions", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId, type])
  @@index([commentId])
  @@index([userId])
}

enum ReactionType {
  LIKE
  LOVE
  HAHA
  WOW
  SAD
  ANGRY
  HELPFUL
  INSIGHTFUL
}

model ForumBookmark {
  id        String      @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime    @default(now())
  Post      ForumPost   @relation(fields: [postId], references: [id], onDelete: Cascade)
  User      User        @relation("ForumBookmarks", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([userId])
}

model ForumPoll {
  id          String          @id @default(cuid())
  postId      String          @unique
  question    String
  allowMultiple Boolean       @default(false)
  endsAt      DateTime?
  createdAt   DateTime        @default(now())
  Post        ForumPost       @relation(fields: [postId], references: [id], onDelete: Cascade)
  Options     ForumPollOption[]
}

model ForumPollOption {
  id        String          @id @default(cuid())
  pollId    String
  text      String
  voteCount Int             @default(0)
  order     Int             @default(0)
  Poll      ForumPoll       @relation(fields: [pollId], references: [id], onDelete: Cascade)
  Votes     ForumPollVote[]

  @@index([pollId])
}

model ForumPollVote {
  id        String          @id @default(cuid())
  optionId  String
  userId    String
  createdAt DateTime        @default(now())
  Option    ForumPollOption @relation(fields: [optionId], references: [id], onDelete: Cascade)
  User      User            @relation("ForumPollVotes", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([optionId, userId])
  @@index([userId])
}

model ForumReport {
  id          String            @id @default(cuid())
  reporterId  String
  postId      String?
  commentId   String?
  reason      ForumReportReason
  description String?
  status      ForumReportStatus @default(PENDING)
  reviewedBy  String?
  reviewedAt  DateTime?
  reviewNote  String?
  createdAt   DateTime          @default(now())
  Reporter    User              @relation("ForumReporter", fields: [reporterId], references: [id])
  Post        ForumPost?        @relation("ReportedPost", fields: [postId], references: [id], onDelete: Cascade)
  Comment     ForumComment?     @relation("ReportedComment", fields: [commentId], references: [id], onDelete: Cascade)
  Reviewer    User?             @relation("ForumReportReviewer", fields: [reviewedBy], references: [id])

  @@index([reporterId])
  @@index([postId])
  @@index([commentId])
  @@index([status])
}

enum ForumReportReason {
  SPAM
  HARASSMENT
  HATE_SPEECH
  MISINFORMATION
  INAPPROPRIATE_CONTENT
  COPYRIGHT_VIOLATION
  OTHER
}

enum ForumReportStatus {
  PENDING
  REVIEWED
  ACTION_TAKEN
  DISMISSED
}

model ForumSettings {
  id                    String   @id @default(cuid())
  allowAnonymousPosts   Boolean  @default(false)
  requirePostApproval   Boolean  @default(false)
  allowMediaUploads     Boolean  @default(true)
  maxMediaSize          Int      @default(10485760) // 10MB
  allowedMediaTypes     String[] @default(["image/jpeg", "image/png", "image/gif", "video/mp4"])
  minPostLength         Int      @default(10)
  maxPostLength         Int      @default(50000)
  minCommentLength      Int      @default(1)
  maxCommentLength      Int      @default(10000)
  autoModerateEnabled   Boolean  @default(false)
  profanityFilterEnabled Boolean @default(true)
  spamFilterEnabled     Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}
