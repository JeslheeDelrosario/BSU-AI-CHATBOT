generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AIInteraction {
  id          String            @id @default(cuid())
  userId      String
  type        AIInteractionType
  context     String?
  userMessage String
  aiResponse  String
  helpful     Boolean?
  createdAt   DateTime          @default(now())
  User        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model AccessibilitySettings {
  id                  String   @id @default(cuid())
  userId              String   @unique
  fontSize            Int      @default(16)
  fontFamily          String   @default("Arial")
  highContrast        Boolean  @default(false)
  colorScheme         String   @default("default")
  reducedMotion       Boolean  @default(false)
  textToSpeechEnabled Boolean  @default(false)
  ttsSpeed            Float    @default(1.0)
  ttsVoice            String   @default("default")
  speechToTextEnabled Boolean  @default(false)
  keyboardOnly        Boolean  @default(false)
  captionsEnabled     Boolean  @default(true)
  transcriptsEnabled  Boolean  @default(true)
  signLanguageEnabled Boolean  @default(false)
  language            String   @default("en")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  User                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Achievement {
  id          String          @id @default(cuid())
  userId      String
  type        AchievementType
  title       String
  description String
  icon        String
  points      Int             @default(0)
  earnedAt    DateTime        @default(now())
  User        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Assessment {
  id               String             @id @default(cuid())
  courseId         String
  lessonId         String?
  title            String
  description      String?
  timeLimit        Int?
  passingScore     Float
  maxAttempts      Int?
  questions        String
  isPublished      Boolean            @default(false)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  AssessmentResult AssessmentResult[]

  @@index([courseId])
}

model AssessmentResult {
  id           String     @id @default(cuid())
  assessmentId String
  userId       String
  score        Float
  answers      String
  timeSpent    Int
  passed       Boolean
  attempt      Int        @default(1)
  completedAt  DateTime   @default(now())
  Assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([assessmentId])
  @@index([userId])
}

model Assignment {
  id                  String         @id @default(cuid())
  courseId            String
  lessonId            String?
  title               String
  description         String
  type                AssignmentType
  maxScore            Float
  dueDate             DateTime?
  allowLateSubmission Boolean        @default(false)
  instructions        String
  rubric              String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  Submission          Submission[]

  @@index([courseId])
}

model ChatSession {
  id        String   @id @default(cuid())
  userId    String
  title     String
  messages  Json
  isStarred Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([updatedAt])
  @@index([userId])
  @@index([isStarred])
}

model ConsultationBooking {
  id          String              @id @default(cuid())
  facultyId   String
  studentId   String
  date        DateTime
  startTime   String
  endTime     String
  topic       String
  notes       String?
  status      ConsultationStatus  @default(PENDING)
  meetingLink String?
  location    String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  Faculty     Faculty             @relation(fields: [facultyId], references: [id], onDelete: Cascade)
  Student     User                @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([facultyId])
  @@index([studentId])
  @@index([date])
  @@index([status])
}

enum ConsultationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  RESCHEDULED
}

model Course {
  id                          String         @id @default(cuid())
  title                       String
  description                 String
  thumbnail                   String?
  level                       CourseLevel
  status                      CourseStatus   @default(DRAFT)
  duration                    Int?
  price                       Float?         @default(0)
  tags                        String[]
  creatorId                   String
  teacherId                   String?
  createdAt                   DateTime       @default(now())
  updatedAt                   DateTime       @updatedAt
  User_Course_creatorIdToUser User           @relation("Course_creatorIdToUser", fields: [creatorId], references: [id])
  User_Course_teacherIdToUser User?          @relation("Course_teacherIdToUser", fields: [teacherId], references: [id])
  CourseReview                CourseReview[]
  Enrollment                  Enrollment[]
  Lesson                      Lesson[]
  Classrooms                  Classroom[]
  modules Module[]  @relation("CourseModules")

  @@index([creatorId])
  @@index([status])
  @@index([teacherId])
}

model CourseReview {
  id        String   @id @default(cuid())
  courseId  String
  userId    String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@index([courseId])
  @@index([userId])
}

model CurriculumEntry {
  id                String            @id @default(cuid())
  programId         String
  yearLevel         Int
  semester          Int
  courseCode        String
  subjectName       String
  lec               Int               @default(0)
  lab               Int               @default(0)
  totalUnits        Int               @default(0)
  lecHours          Int               @default(0)
  labHours          Int               @default(0)
  totalHours        Int               @default(0)
  prerequisites     String[]          @default([])
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  UniversityProgram UniversityProgram @relation(fields: [programId], references: [id])
}

model Enrollment {
  id             String           @id @default(cuid())
  userId         String
  courseId       String
  status         EnrollmentStatus @default(ACTIVE)
  progress       Float            @default(0)
  enrolledAt     DateTime         @default(now())
  completedAt    DateTime?
  lastAccessedAt DateTime?
  Course         Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  User           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([courseId])
  @@index([userId])
}

model FAQ {
  id          String   @id @default(cuid())
  category    String
  question    String
  answer      String
  keywords    String[]
  viewCount   Int      @default(0)
  helpful     Int      @default(0)
  notHelpful  Int      @default(0)
  isPublished Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([isPublished])
}

model Faculty {
  id                   String                 @id @default(cuid())
  firstName            String
  middleName           String?
  lastName             String
  email                String?
  position             String
  college              String                 @default("College of Science")
  officeHours          String?
  consultationDays     String[]               @default([])
  consultationStart    String?
  consultationEnd      String?
  vacantTime           String?
  FacultySchedule      FacultySchedule[]
  FacultySubject       FacultySubject[]
  ConsultationBookings ConsultationBooking[]
}

model FacultySchedule {
  id           String  @id @default(cuid())
  facultyId    String
  dayOfWeek    String
  startTime    String
  endTime      String
  subject      String?
  room         String?
  scheduleType String  @default("CLASS")
  Faculty      Faculty @relation(fields: [facultyId], references: [id], onDelete: Cascade)

  @@index([facultyId])
}

model FacultySubject {
  id        String  @id @default(cuid())
  facultyId String
  subjectId String
  Faculty   Faculty @relation(fields: [facultyId], references: [id])
  Subject   Subject @relation(fields: [subjectId], references: [id])
}

model GroupMessage {
  id          String     @id @default(cuid())
  groupId     String
  userId      String
  content     String
  attachments String[]
  createdAt   DateTime   @default(now())
  StudyGroup  StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([groupId])
}

model Lesson {
  id          String     @id @default(cuid())
  courseId    String
  title       String
  description String?
  type        LessonType
  content     String
  videoUrl    String?
  audioUrl    String?
  transcript  String?
  duration    Int?
  order       Int
  isPublished Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  Course      Course     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  Progress    Progress[]
  Resource    Resource[]
  moduleId String?
  module   Module? @relation(fields: [moduleId], references: [id])


  @@index([courseId])
  @@index([order])
}

model Message {
  id                            String   @id @default(cuid())
  senderId                      String
  receiverId                    String
  subject                       String?
  content                       String
  isRead                        Boolean  @default(false)
  createdAt                     DateTime @default(now())
  User_Message_receiverIdToUser User     @relation("Message_receiverIdToUser", fields: [receiverId], references: [id], onDelete: Cascade)
  User_Message_senderIdToUser   User     @relation("Message_senderIdToUser", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([receiverId])
  @@index([senderId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String   // NEW_POST, NEW_COMMENT, ROLE_ASSIGNED, etc.
  link      String?
  metadata  Json?    // Additional data (classroomId, postId, etc.)
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
  @@index([type])
}

model Progress {
  id           String    @id @default(cuid())
  userId       String
  lessonId     String
  completed    Boolean   @default(false)
  timeSpent    Int       @default(0)
  lastPosition Int?
  attempts     Int       @default(0)
  score        Float?
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  updatedAt    DateTime  @updatedAt
  Lesson       Lesson    @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  User         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
  @@index([lessonId])
  @@index([userId])
}

model Resource {
  id        String   @id @default(cuid())
  lessonId  String
  title     String
  type      String
  url       String
  size      Int?
  createdAt DateTime @default(now())
  Lesson    Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}

model StudyGroup {
  id               String             @id @default(cuid())
  name             String
  description      String?
  courseId         String?
  maxMembers       Int                @default(10)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  GroupMessage     GroupMessage[]
  StudyGroupMember StudyGroupMember[]
}

model StudyGroupMember {
  id         String     @id @default(cuid())
  groupId    String
  userId     String
  role       String     @default("member")
  joinedAt   DateTime   @default(now())
  StudyGroup StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  User       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
}

model Subject {
  id             String           @id @default(cuid())
  code           String
  name           String
  FacultySubject FacultySubject[]
}

model Submission {
  id           String           @id @default(cuid())
  assignmentId String
  userId       String
  content      String
  attachments  String[]
  status       SubmissionStatus @default(DRAFT)
  score        Float?
  feedback     String?
  gradedBy     String?
  gradedAt     DateTime?
  submittedAt  DateTime?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  Assignment   Assignment       @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  User         User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([assignmentId, userId])
  @@index([assignmentId])
  @@index([userId])
}

model UniversityProgram {
  id              String            @id @default(cuid())
  title           String            @unique
  abbreviation    String?
  college         String
  isActive        Boolean           @default(true)
  order           Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  CurriculumEntry CurriculumEntry[]

  @@index([college])
  @@index([isActive])
}

model User {
  id                               String                 @id @default(cuid())
  email                            String                 @unique
  password                         String
  firstName                        String
  lastName                         String
  role                             UserRole               @default(STUDENT)
  avatar                           String?
  phoneNumber                      String?
  course                           String?
  section                          String?
  isActive                         Boolean                @default(true)
  createdAt                        DateTime               @default(now())
  updatedAt                        DateTime               @updatedAt
  learningStyle                    LearningStyle?
  gradeLevel                       String?
  dateOfBirth                      DateTime?
  parentId                         String?
  AIInteraction                    AIInteraction[]
  AccessibilitySettings            AccessibilitySettings?
  Achievement                      Achievement[]
  AssessmentResult                 AssessmentResult[]
  ChatSession                      ChatSession[]
  Course_Course_creatorIdToUser    Course[]               @relation("Course_creatorIdToUser")
  Course_Course_teacherIdToUser    Course[]               @relation("Course_teacherIdToUser")
  CourseReview                     CourseReview[]
  Enrollment                       Enrollment[]
  Message_Message_receiverIdToUser Message[]              @relation("Message_receiverIdToUser")
  Message_Message_senderIdToUser   Message[]              @relation("Message_senderIdToUser")
  Notification                     Notification[]
  Progress                         Progress[]
  StudyGroupMember                 StudyGroupMember[]
  Submission                       Submission[]
  ConsultationBookings             ConsultationBooking[]
  ClassroomMembers                 ClassroomMember[]
  ClassroomPosts                   ClassroomPost[]        @relation("ClassroomPostAuthor")
  ClassroomComments                ClassroomComment[]     @relation("ClassroomCommentAuthor")
  PostReactions                    PostReaction[]         @relation("PostReactionUser")
  CommentReactions                 CommentReaction[]      @relation("CommentReactionUser")
  AssignmentSubmissions            AssignmentSubmission[] @relation("AssignmentSubmissionStudent")
  ClassroomJoinRequests            ClassroomJoinRequest[] @relation("JoinRequestUser")
  ReviewedJoinRequests             ClassroomJoinRequest[] @relation("JoinRequestReviewer")
  User                             User?                  @relation("UserToUser", fields: [parentId], references: [id])
  other_User                       User[]                 @relation("UserToUser")
  userModuleProgresses             UserModuleProgress[]   @relation("UserModuleProgresses")
  OrganizedMeetings                Meeting[]              @relation("MeetingOrganizer")
  MeetingParticipations            MeetingParticipant[]   @relation("MeetingParticipants")
  createdClassroomMeetings         ClassroomMeeting[]     @relation("ClassroomMeetingCreator")
  classroomMeetingAttendances      ClassroomMeetingAttendee[] @relation("ClassroomMeetingAttendees")
  googleAccessToken                String?
  googleRefreshToken               String?
  googleTokenExpiry                DateTime?

  @@index([email])
  @@index([role])
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}

enum AIInteractionType {
  QUESTION
  EXPLANATION
  EXAMPLE
  HINT
  FEEDBACK
  TRANSLATION
  SUMMARY
}

enum AchievementType {
  COURSE_COMPLETION
  STREAK
  PERFECT_SCORE
  EARLY_BIRD
  NIGHT_OWL
  HELPFUL_PEER
  MILESTONE
}

enum AssignmentType {
  ESSAY
  MULTIPLE_CHOICE
  SHORT_ANSWER
  PROJECT
  CODING
  PRESENTATION
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum CourseStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum EnrollmentStatus {
  ACTIVE
  COMPLETED
  DROPPED
  PAUSED
}

enum LearningStyle {
  VISUAL
  AUDITORY
  KINESTHETIC
  READING_WRITING
  MIXED
}

enum LessonType {
  VIDEO
  TEXT
  AUDIO
  INTERACTIVE
  QUIZ
  ASSIGNMENT
}

enum SubmissionStatus {
  DRAFT
  SUBMITTED
  GRADED
  RETURNED
}

enum UserRole {
  STUDENT
  TEACHER
  PARENT
  ADMIN
  CONTENT_CREATOR
}

// ============================================
// CLASSROOM SYSTEM MODELS
// ============================================

model Classroom {
  id              String            @id @default(cuid())
  courseId        String
  name            String
  section         String?
  sections        String?           // Additional sections info for About page
  description     String?
  inviteCode      String            @unique @default(cuid())
  isArchived      Boolean           @default(false)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  Course          Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  ClassroomPosts  ClassroomPost[]
  ClassroomMembers ClassroomMember[]
  ClassroomJoinRequests ClassroomJoinRequest[]
  ClassroomMeetings ClassroomMeeting[]
  
  @@index([courseId])
  @@index([inviteCode])
  @@index([isArchived])
}

model ClassroomMember {
  id          String          @id @default(cuid())
  classroomId String
  userId      String
  role        ClassroomRole   @default(STUDENT)
  joinedAt    DateTime        @default(now())
  lastSeenAt  DateTime?
  Classroom   Classroom       @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  User        User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([classroomId, userId])
  @@index([classroomId])
  @@index([userId])
}

enum ClassroomRole {
  TEACHER
  STUDENT
  PRESIDENT      // Student with posting privileges
  VICE_PRESIDENT // Student with posting privileges
  MODERATOR      // Student with posting privileges
  TA
}

model ClassroomJoinRequest {
  id          String              @id @default(cuid())
  classroomId String
  userId      String
  status      JoinRequestStatus   @default(PENDING)
  message     String?             // Optional message from student
  attachments String[]            @default([]) // File URLs (PDF/DOCX proof of enrollment)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  reviewedBy  String?             // Teacher who approved/rejected
  reviewedAt  DateTime?
  Classroom   Classroom           @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  User        User                @relation("JoinRequestUser", fields: [userId], references: [id], onDelete: Cascade)
  Reviewer    User?               @relation("JoinRequestReviewer", fields: [reviewedBy], references: [id])
  
  @@unique([classroomId, userId])
  @@index([classroomId])
  @@index([userId])
  @@index([status])
}

enum JoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model ClassroomPost {
  id              String              @id @default(cuid())
  classroomId     String
  authorId        String
  type            PostType
  title           String?
  content         String
  attachments     Json                @default("[]")
  images          String[]            @default([])
  isPinned        Boolean             @default(false)
  visibility      PostVisibility      @default(ALL_STUDENTS)
  publishedAt     DateTime            @default(now())
  dueDate         DateTime?
  points          Int?
  allowLateSubmission Boolean         @default(true)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  Classroom       Classroom           @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  Author          User                @relation("ClassroomPostAuthor", fields: [authorId], references: [id])
  Comments        ClassroomComment[]
  Submissions     AssignmentSubmission[]
  Reactions       PostReaction[]
  
  @@index([classroomId])
  @@index([authorId])
  @@index([type])
  @@index([publishedAt])
  @@index([dueDate])
}

enum PostVisibility {
  ALL_STUDENTS
  MODERATORS_ONLY
}

enum PostType {
  ANNOUNCEMENT
  MATERIAL
  DISCUSSION
  
  // Major Academic Work
  PROJECT
  CAPSTONE_PROJECT
  THESIS
  RESEARCH_PAPER
  CASE_STUDY
  FEASIBILITY_STUDY
  PROPOSAL
  
  // Coursework & Submissions
  ASSIGNMENT
  HOMEWORK
  SEATWORK
  WORKSHEET
  WRITTEN_EXERCISE
  PRACTICE_TASK
  
  // Activities
  ACTIVITY
  CLASS_ACTIVITY
  GROUP_ACTIVITY
  INDIVIDUAL_ACTIVITY
  LABORATORY_ACTIVITY
  HANDS_ON_ACTIVITY
  WORKSHOP_ACTIVITY
  
  // Assessments
  QUIZ
  SHORT_QUIZ
  LONG_QUIZ
  PRE_TEST
  POST_TEST
  EXAMINATION
  MIDTERM_EXAM
  FINAL_EXAM
  PRACTICAL_EXAM
  
  // Collaboration & Participation
  GROUP_WORK
  PAIR_WORK
  TEAM_TASK
  DISCUSSION_TASK
  RECITATION
  PARTICIPATION_TASK
  
  // Output & Presentations
  PRESENTATION
  ORAL_PRESENTATION
  VIDEO_PRESENTATION
  POSTER
  PORTFOLIO
  CREATIVE_OUTPUT
  
  // Reflection & Evaluation
  REFLECTION_PAPER
  LEARNING_JOURNAL
  SELF_ASSESSMENT
  PEER_EVALUATION
  FEEDBACK
  
  // Online / Submission-Based
  ONLINE_ACTIVITY
  ONLINE_SUBMISSION
  FORUM_POST
  DISCUSSION_BOARD_RESPONSE
  
  // Practicum / Experience-Based
  INTERNSHIP_REQUIREMENT
  OJT_REQUIREMENT
  PRACTICUM_ACTIVITY
  FIELD_STUDY
  OBSERVATION_REPORT
}

model ClassroomComment {
  id          String            @id @default(cuid())
  postId      String
  authorId    String
  parentId    String?
  content     String
  attachments Json              @default("[]")
  isPrivate   Boolean           @default(false)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  Post        ClassroomPost     @relation(fields: [postId], references: [id], onDelete: Cascade)
  Author      User              @relation("ClassroomCommentAuthor", fields: [authorId], references: [id])
  Parent      ClassroomComment? @relation("CommentReplies", fields: [parentId], references: [id])
  Replies     ClassroomComment[] @relation("CommentReplies")
  Reactions   CommentReaction[]
  
  @@index([postId])
  @@index([authorId])
  @@index([parentId])
  @@index([createdAt])
}

model PostReaction {
  id        String        @id @default(cuid())
  postId    String
  userId    String
  emoji     String
  createdAt DateTime      @default(now())
  Post      ClassroomPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  User      User          @relation("PostReactionUser", fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([postId, userId, emoji])
  @@index([postId])
}

model CommentReaction {
  id        String           @id @default(cuid())
  commentId String
  userId    String
  emoji     String
  createdAt DateTime         @default(now())
  Comment   ClassroomComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  User      User             @relation("CommentReactionUser", fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([commentId, userId, emoji])
  @@index([commentId])
}

model AssignmentSubmission {
  id              String              @id @default(cuid())
  assignmentId    String
  studentId       String
  content         String?
  attachments     Json                @default("[]")
  status          SubmissionStatus    @default(DRAFT)
  submittedAt     DateTime?
  grade           Float?
  feedback        String?
  isLate          Boolean             @default(false)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  Assignment      ClassroomPost       @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  Student         User                @relation("AssignmentSubmissionStudent", fields: [studentId], references: [id])
  
  @@unique([assignmentId, studentId])
  @@index([assignmentId])
  @@index([studentId])
  @@index([status])
}

model Module {
  id          String   @id @default(cuid())
  title       String
  description String?
  order       Int
  courseId    String

  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade, name: "CourseModules")
  lessons     Lesson[]
  quiz        Quiz?
  progresses  UserModuleProgress[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Quiz {
  id           String   @id @default(cuid())
  moduleId     String   @unique
  passingScore Int      @default(70)

  module       Module   @relation(fields: [moduleId], references: [id])
  questions    Question[]

  createdAt    DateTime @default(now())
}

model Question {
  id        String   @id @default(cuid())
  quizId    String
  text      String
  type      QuestionType

  quiz      Quiz     @relation(fields: [quizId], references: [id])
  answers   Answer[]

  createdAt DateTime @default(now())
}

model Answer {
  id          String   @id @default(cuid())
  questionId  String
  text        String
  isCorrect   Boolean @default(false)

  question    Question @relation(fields: [questionId], references: [id])
}

model UserModuleProgress {
  id         String   @id @default(cuid())
  userId     String
  moduleId   String
  completed  Boolean  @default(false)
  score      Int?
  completedAt DateTime?

  module Module @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, name: "UserModuleProgresses")

  @@unique([userId, moduleId])
}


enum QuestionType {
  MCQ
  TRUE_FALSE
}

// ============================================
// ROOM & MEETING MANAGEMENT MODELS
// ============================================

model Room {
  id          String   @id @default(cuid())
  name        String
  building    String
  floor       Int?
  capacity    Int
  type        RoomType @default(CLASSROOM)
  facilities  String[] @default([])
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  Meetings    Meeting[]
  
  @@unique([name, building])
  @@index([building])
  @@index([type])
  @@index([isActive])
}

enum RoomType {
  CLASSROOM
  LABORATORY
  CONFERENCE
  LECTURE_HALL
  COMPUTER_LAB
  LIBRARY
  STUDY_ROOM
  AUDITORIUM
}

model Meeting {
  id              String        @id @default(cuid())
  title           String
  description     String?
  organizerId     String
  roomId          String?
  meetingType     MeetingType
  googleMeetLink  String?
  startTime       DateTime
  endTime         DateTime
  isRecurring     Boolean       @default(false)
  recurrenceRule  String?
  status          MeetingStatus @default(SCHEDULED)
  maxParticipants Int?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  Organizer       User          @relation("MeetingOrganizer", fields: [organizerId], references: [id], onDelete: Cascade)
  Room            Room?         @relation(fields: [roomId], references: [id])
  Participants    MeetingParticipant[]
  
  @@index([organizerId])
  @@index([roomId])
  @@index([startTime])
  @@index([endTime])
  @@index([status])
  @@index([meetingType])
}

enum MeetingType {
  ONLINE
  IN_PERSON
  HYBRID
  CONSULTATION
  CLASS
  EXAM
  WORKSHOP
  SEMINAR
}

enum MeetingStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

model MeetingParticipant {
  id         String              @id @default(cuid())
  meetingId  String
  userId     String
  role       ParticipantRole     @default(ATTENDEE)
  status     ParticipantStatus   @default(INVITED)
  joinedAt   DateTime?
  leftAt     DateTime?
  createdAt  DateTime            @default(now())
  Meeting    Meeting             @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  User       User                @relation("MeetingParticipants", fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([meetingId, userId])
  @@index([meetingId])
  @@index([userId])
  @@index([status])
}

enum ParticipantRole {
  ORGANIZER
  CO_ORGANIZER
  PRESENTER
  ATTENDEE
}

enum ParticipantStatus {
  INVITED
  ACCEPTED
  DECLINED
  ATTENDED
  ABSENT
}

// Classroom Meeting Management
model ClassroomMeeting {
  id                    String                    @id @default(cuid())
  classroomId           String
  title                 String
  description           String?
  meetingType           ClassroomMeetingType      @default(LECTURE)
  googleMeetLink        String
  googleCalendarEventId String?
  startTime             DateTime
  endTime               DateTime
  status                ClassroomMeetingStatus    @default(SCHEDULED)
  createdById           String
  isRecurring           Boolean                   @default(false)
  recurrenceRule        String?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  
  Classroom       Classroom                 @relation(fields: [classroomId], references: [id], onDelete: Cascade)
  CreatedBy       User                      @relation("ClassroomMeetingCreator", fields: [createdById], references: [id])
  Attendees       ClassroomMeetingAttendee[]
  
  @@index([classroomId])
  @@index([startTime])
  @@index([status])
  @@index([createdById])
}

model ClassroomMeetingAttendee {
  id              String                    @id @default(cuid())
  meetingId       String
  userId          String
  status          AttendeeStatus            @default(INVITED)
  joinedAt        DateTime?
  leftAt          DateTime?
  createdAt       DateTime                  @default(now())
  
  Meeting         ClassroomMeeting          @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  User            User                      @relation("ClassroomMeetingAttendees", fields: [userId], references: [id])
  
  @@unique([meetingId, userId])
  @@index([meetingId])
  @@index([userId])
  @@index([status])
}

enum ClassroomMeetingType {
  LECTURE
  LAB_SESSION
  DISCUSSION
  EXAM
  QUIZ
  OFFICE_HOURS
  REVIEW_SESSION
  WORKSHOP
  SEMINAR
  GROUP_WORK
}

enum ClassroomMeetingStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum AttendeeStatus {
  INVITED
  ACCEPTED
  DECLINED
  ATTENDED
  ABSENT
}
