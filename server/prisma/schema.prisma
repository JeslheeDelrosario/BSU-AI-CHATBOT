generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String                 @id @default(uuid())
  email                 String                 @unique
  password              String
  firstName             String
  lastName              String
  role                  UserRole               @default(STUDENT)
  avatar                String?
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  learningStyle         LearningStyle?
  gradeLevel            String?
  dateOfBirth           DateTime?
  parentId              String?
  aiInteractions        AIInteraction[]
  accessibilitySettings AccessibilitySettings?
  achievements          Achievement[]
  assessmentResults     AssessmentResult[]
  chatSessions          ChatSession[]          @relation("UserChatSessions")
  createdCourses        Course[]               @relation("CourseCreator")
  teachingCourses       Course[]               @relation("CourseTeacher")
  courseReviews         CourseReview[]
  enrollments           Enrollment[]
  receivedMessages      Message[]              @relation("ReceivedMessages")
  messages              Message[]              @relation("SentMessages")
  notifications         Notification[]
  progress              Progress[]
  studyGroups           StudyGroupMember[]
  submissions           Submission[]
  parent                User?                  @relation("ParentChildren", fields: [parentId], references: [id])
  children              User[]                 @relation("ParentChildren")

  @@index([email])
  @@index([role])
}

model AccessibilitySettings {
  id                  String   @id @default(uuid())
  userId              String   @unique
  fontSize            Int      @default(16)
  fontFamily          String   @default("Arial")
  highContrast        Boolean  @default(false)
  colorScheme         String   @default("default")
  reducedMotion       Boolean  @default(false)
  textToSpeechEnabled Boolean  @default(false)
  ttsSpeed            Float    @default(1.0)
  ttsVoice            String   @default("default")
  speechToTextEnabled Boolean  @default(false)
  keyboardOnly        Boolean  @default(false)
  captionsEnabled     Boolean  @default(true)
  transcriptsEnabled  Boolean  @default(true)
  signLanguageEnabled Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Course {
  id          String         @id @default(uuid())
  title       String
  description String
  thumbnail   String?
  level       CourseLevel
  status      CourseStatus   @default(DRAFT)
  duration    Int?
  price       Float?         @default(0)
  tags        String[]
  creatorId   String
  teacherId   String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  creator     User           @relation("CourseCreator", fields: [creatorId], references: [id])
  teacher     User?          @relation("CourseTeacher", fields: [teacherId], references: [id])
  reviews     CourseReview[]
  enrollments Enrollment[]
  lessons     Lesson[]

  @@index([status])
  @@index([creatorId])
  @@index([teacherId])
}

model Lesson {
  id          String     @id @default(uuid())
  courseId    String
  title       String
  description String?
  type        LessonType
  content     String
  videoUrl    String?
  audioUrl    String?
  transcript  String?
  duration    Int?
  order       Int
  isPublished Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  course      Course     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  progress    Progress[]
  resources   Resource[]

  @@index([courseId])
  @@index([order])
}

model Resource {
  id        String   @id @default(uuid())
  lessonId  String
  title     String
  type      String
  url       String
  size      Int?
  createdAt DateTime @default(now())
  lesson    Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}

model Enrollment {
  id             String           @id @default(uuid())
  userId         String
  courseId       String
  status         EnrollmentStatus @default(ACTIVE)
  progress       Float            @default(0)
  enrolledAt     DateTime         @default(now())
  completedAt    DateTime?
  lastAccessedAt DateTime?
  course         Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([userId])
  @@index([courseId])
}

model Progress {
  id           String    @id @default(uuid())
  userId       String
  lessonId     String
  completed    Boolean   @default(false)
  timeSpent    Int       @default(0)
  lastPosition Int?
  attempts     Int       @default(0)
  score        Float?
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  updatedAt    DateTime  @updatedAt
  lesson       Lesson    @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
  @@index([userId])
  @@index([lessonId])
}

model Assignment {
  id                  String         @id @default(uuid())
  courseId            String
  lessonId            String?
  title               String
  description         String
  type                AssignmentType
  maxScore            Float
  dueDate             DateTime?
  allowLateSubmission Boolean        @default(false)
  instructions        String
  rubric              String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  submissions         Submission[]

  @@index([courseId])
}

model Submission {
  id           String           @id @default(uuid())
  assignmentId String
  userId       String
  content      String
  attachments  String[]
  status       SubmissionStatus @default(DRAFT)
  score        Float?
  feedback     String?
  gradedBy     String?
  gradedAt     DateTime?
  submittedAt  DateTime?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  assignment   Assignment       @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  user         User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([assignmentId, userId])
  @@index([userId])
  @@index([assignmentId])
}

model Assessment {
  id           String             @id @default(uuid())
  courseId     String
  lessonId     String?
  title        String
  description  String?
  timeLimit    Int?
  passingScore Float
  maxAttempts  Int?
  questions    String
  isPublished  Boolean            @default(false)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  results      AssessmentResult[]

  @@index([courseId])
}

model AssessmentResult {
  id           String     @id @default(uuid())
  assessmentId String
  userId       String
  score        Float
  answers      String
  timeSpent    Int
  passed       Boolean
  attempt      Int        @default(1)
  completedAt  DateTime   @default(now())
  assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([assessmentId])
}

model AIInteraction {
  id          String            @id @default(uuid())
  userId      String
  type        AIInteractionType
  context     String?
  userMessage String
  aiResponse  String
  helpful     Boolean?
  createdAt   DateTime          @default(now())
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model Achievement {
  id          String          @id @default(uuid())
  userId      String
  type        AchievementType
  title       String
  description String
  icon        String
  points      Int             @default(0)
  earnedAt    DateTime        @default(now())
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model StudyGroup {
  id          String             @id @default(uuid())
  name        String
  description String?
  courseId    String?
  maxMembers  Int                @default(10)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  messages    GroupMessage[]
  members     StudyGroupMember[]
}

model StudyGroupMember {
  id       String     @id @default(uuid())
  groupId  String
  userId   String
  role     String     @default("member")
  joinedAt DateTime   @default(now())
  group    StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user     User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
}

model GroupMessage {
  id          String     @id @default(uuid())
  groupId     String
  userId      String
  content     String
  attachments String[]
  createdAt   DateTime   @default(now())
  group       StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@index([createdAt])
}

model Message {
  id         String   @id @default(uuid())
  senderId   String
  receiverId String
  subject    String?
  content    String
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  type      String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
}

model CourseReview {
  id        String   @id @default(uuid())
  courseId  String
  userId    String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@index([courseId])
  @@index([userId])
}

model UniversityProgram {
  id              String            @id @default(uuid())
  title           String            @unique
  abbreviation    String?
  college         String
  isActive        Boolean           @default(true)
  order           Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  CurriculumEntry CurriculumEntry[]

  @@index([college])
  @@index([isActive])
}

model ChatSession {
  id        String   @id @default(uuid())
  userId    String
  title     String
  messages  Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation("UserChatSessions", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([updatedAt])
}

model Faculty {
  id        String           @id @default(uuid())
  firstName String
  lastName  String
  email     String?
  position  String
  college   String           @default("College of Science")
  subjects  FacultySubject[]
}

model Subject {
  id      String           @id @default(uuid())
  code    String
  name    String
  faculty FacultySubject[]
}

model FacultySubject {
  id        String  @id @default(uuid())
  facultyId String
  subjectId String
  faculty   Faculty @relation(fields: [facultyId], references: [id])
  subject   Subject @relation(fields: [subjectId], references: [id])
}

model CurriculumEntry {
  id            String            @id @default(cuid())
  programId     String
  yearLevel     Int
  semester      Int
  courseCode    String
  subjectName   String
  units         Int
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  prerequisites String[]          @default([])
  program       UniversityProgram @relation(fields: [programId], references: [id])
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}

enum UserRole {
  STUDENT
  TEACHER
  PARENT
  ADMIN
  CONTENT_CREATOR
}

enum LearningStyle {
  VISUAL
  AUDITORY
  KINESTHETIC
  READING_WRITING
  MIXED
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum CourseStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum LessonType {
  VIDEO
  TEXT
  AUDIO
  INTERACTIVE
  QUIZ
  ASSIGNMENT
}

enum EnrollmentStatus {
  ACTIVE
  COMPLETED
  DROPPED
  PAUSED
}

enum AssignmentType {
  ESSAY
  MULTIPLE_CHOICE
  SHORT_ANSWER
  PROJECT
  CODING
  PRESENTATION
}

enum SubmissionStatus {
  DRAFT
  SUBMITTED
  GRADED
  RETURNED
}

enum AIInteractionType {
  QUESTION
  EXPLANATION
  EXAMPLE
  HINT
  FEEDBACK
  TRANSLATION
  SUMMARY
}

enum AchievementType {
  COURSE_COMPLETION
  STREAK
  PERFECT_SCORE
  EARLY_BIRD
  NIGHT_OWL
  HELPFUL_PEER
  MILESTONE
}
