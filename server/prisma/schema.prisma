generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AIInteraction {
  id          String            @id @default(cuid())
  userId      String
  type        AIInteractionType
  context     String?
  userMessage String
  aiResponse  String
  helpful     Boolean?
  createdAt   DateTime          @default(now())
  User        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model AccessibilitySettings {
  id                  String   @id @default(cuid())
  userId              String   @unique
  fontSize            Int      @default(16)
  fontFamily          String   @default("Arial")
  highContrast        Boolean  @default(false)
  colorScheme         String   @default("default")
  reducedMotion       Boolean  @default(false)
  textToSpeechEnabled Boolean  @default(false)
  ttsSpeed            Float    @default(1.0)
  ttsVoice            String   @default("default")
  speechToTextEnabled Boolean  @default(false)
  keyboardOnly        Boolean  @default(false)
  captionsEnabled     Boolean  @default(true)
  transcriptsEnabled  Boolean  @default(true)
  signLanguageEnabled Boolean  @default(false)
  language            String   @default("en")
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  User                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Achievement {
  id          String          @id @default(cuid())
  userId      String
  type        AchievementType
  title       String
  description String
  icon        String
  points      Int             @default(0)
  earnedAt    DateTime        @default(now())
  User        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Assessment {
  id               String             @id @default(cuid())
  courseId         String
  lessonId         String?
  title            String
  description      String?
  timeLimit        Int?
  passingScore     Float
  maxAttempts      Int?
  questions        String
  isPublished      Boolean            @default(false)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  AssessmentResult AssessmentResult[]

  @@index([courseId])
}

model AssessmentResult {
  id           String     @id @default(cuid())
  assessmentId String
  userId       String
  score        Float
  answers      String
  timeSpent    Int
  passed       Boolean
  attempt      Int        @default(1)
  completedAt  DateTime   @default(now())
  Assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([assessmentId])
  @@index([userId])
}

model Assignment {
  id                  String         @id @default(cuid())
  courseId            String
  lessonId            String?
  title               String
  description         String
  type                AssignmentType
  maxScore            Float
  dueDate             DateTime?
  allowLateSubmission Boolean        @default(false)
  instructions        String
  rubric              String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime
  Submission          Submission[]

  @@index([courseId])
}

model ChatSession {
  id        String   @id @default(cuid())
  userId    String
  title     String
  messages  Json
  isStarred Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([updatedAt])
  @@index([userId])
  @@index([isStarred])
}

model Course {
  id                          String         @id @default(cuid())
  title                       String
  description                 String
  thumbnail                   String?
  level                       CourseLevel
  status                      CourseStatus   @default(DRAFT)
  duration                    Int?
  price                       Float?         @default(0)
  tags                        String[]
  creatorId                   String
  teacherId                   String?
  createdAt                   DateTime       @default(now())
  updatedAt                   DateTime
  User_Course_creatorIdToUser User           @relation("Course_creatorIdToUser", fields: [creatorId], references: [id])
  User_Course_teacherIdToUser User?          @relation("Course_teacherIdToUser", fields: [teacherId], references: [id])
  CourseReview                CourseReview[]
  Enrollment                  Enrollment[]
  Lesson                      Lesson[]

  @@index([creatorId])
  @@index([status])
  @@index([teacherId])
}

model CourseReview {
  id        String   @id @default(cuid())
  courseId  String
  userId    String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  Course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@index([courseId])
  @@index([userId])
}

model CurriculumEntry {
  id                String            @id @default(cuid())
  programId         String
  yearLevel         Int
  semester          Int
  courseCode        String
  subjectName       String
  lec               Int               @default(0)
  lab               Int               @default(0)
  totalUnits        Int               @default(0)
  lecHours          Int               @default(0)
  labHours          Int               @default(0)
  totalHours        Int               @default(0)
  prerequisites     String[]          @default([])
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  UniversityProgram UniversityProgram @relation(fields: [programId], references: [id])
}

model Enrollment {
  id             String           @id @default(cuid())
  userId         String
  courseId       String
  status         EnrollmentStatus @default(ACTIVE)
  progress       Float            @default(0)
  enrolledAt     DateTime         @default(now())
  completedAt    DateTime?
  lastAccessedAt DateTime?
  Course         Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  User           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([courseId])
  @@index([userId])
}

model FAQ {
  id          String   @id @default(cuid())
  category    String
  question    String
  answer      String
  keywords    String[]
  viewCount   Int      @default(0)
  helpful     Int      @default(0)
  notHelpful  Int      @default(0)
  isPublished Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([category])
  @@index([isPublished])
}

model Faculty {
  id                String            @id @default(cuid())
  firstName         String
  middleName        String?
  lastName          String
  email             String?
  position          String
  college           String            @default("College of Science")
  officeHours       String?
  consultationDays  String[]          @default([])
  consultationStart String?
  consultationEnd   String?
  vacantTime        String?
  FacultySchedule   FacultySchedule[]
  FacultySubject    FacultySubject[]
}

model FacultySchedule {
  id           String  @id @default(cuid())
  facultyId    String
  dayOfWeek    String
  startTime    String
  endTime      String
  subject      String?
  room         String?
  scheduleType String  @default("CLASS")
  Faculty      Faculty @relation(fields: [facultyId], references: [id], onDelete: Cascade)

  @@index([facultyId])
}

model FacultySubject {
  id        String  @id @default(cuid())
  facultyId String
  subjectId String
  Faculty   Faculty @relation(fields: [facultyId], references: [id])
  Subject   Subject @relation(fields: [subjectId], references: [id])
}

model GroupMessage {
  id          String     @id @default(cuid())
  groupId     String
  userId      String
  content     String
  attachments String[]
  createdAt   DateTime   @default(now())
  StudyGroup  StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([groupId])
}

model Lesson {
  id          String     @id @default(cuid())
  courseId    String
  title       String
  description String?
  type        LessonType
  content     String
  videoUrl    String?
  audioUrl    String?
  transcript  String?
  duration    Int?
  order       Int
  isPublished Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  Course      Course     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  Progress    Progress[]
  Resource    Resource[]

  @@index([courseId])
  @@index([order])
}

model Message {
  id                            String   @id @default(cuid())
  senderId                      String
  receiverId                    String
  subject                       String?
  content                       String
  isRead                        Boolean  @default(false)
  createdAt                     DateTime @default(now())
  User_Message_receiverIdToUser User     @relation("Message_receiverIdToUser", fields: [receiverId], references: [id], onDelete: Cascade)
  User_Message_senderIdToUser   User     @relation("Message_senderIdToUser", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([receiverId])
  @@index([senderId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
}

model Progress {
  id           String    @id @default(cuid())
  userId       String
  lessonId     String
  completed    Boolean   @default(false)
  timeSpent    Int       @default(0)
  lastPosition Int?
  attempts     Int       @default(0)
  score        Float?
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  updatedAt    DateTime
  Lesson       Lesson    @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  User         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
  @@index([lessonId])
  @@index([userId])
}

model Resource {
  id        String   @id @default(cuid())
  lessonId  String
  title     String
  type      String
  url       String
  size      Int?
  createdAt DateTime @default(now())
  Lesson    Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}

model StudyGroup {
  id               String             @id @default(cuid())
  name             String
  description      String?
  courseId         String?
  maxMembers       Int                @default(10)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  GroupMessage     GroupMessage[]
  StudyGroupMember StudyGroupMember[]
}

model StudyGroupMember {
  id         String     @id @default(cuid())
  groupId    String
  userId     String
  role       String     @default("member")
  joinedAt   DateTime   @default(now())
  StudyGroup StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  User       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
}

model Subject {
  id             String           @id @default(cuid())
  code           String
  name           String
  FacultySubject FacultySubject[]
}

model Submission {
  id           String           @id @default(cuid())
  assignmentId String
  userId       String
  content      String
  attachments  String[]
  status       SubmissionStatus @default(DRAFT)
  score        Float?
  feedback     String?
  gradedBy     String?
  gradedAt     DateTime?
  submittedAt  DateTime?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime
  Assignment   Assignment       @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  User         User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([assignmentId, userId])
  @@index([assignmentId])
  @@index([userId])
}

model UniversityProgram {
  id              String            @id @default(cuid())
  title           String            @unique
  abbreviation    String?
  college         String
  isActive        Boolean           @default(true)
  order           Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  CurriculumEntry CurriculumEntry[]

  @@index([college])
  @@index([isActive])
}

model User {
  id                               String                 @id @default(cuid())
  email                            String                 @unique
  password                         String
  firstName                        String
  lastName                         String
  role                             UserRole               @default(STUDENT)
  avatar                           String?
  isActive                         Boolean                @default(true)
  createdAt                        DateTime               @default(now())
  updatedAt                        DateTime
  learningStyle                    LearningStyle?
  gradeLevel                       String?
  dateOfBirth                      DateTime?
  parentId                         String?
  AIInteraction                    AIInteraction[]
  AccessibilitySettings            AccessibilitySettings?
  Achievement                      Achievement[]
  AssessmentResult                 AssessmentResult[]
  ChatSession                      ChatSession[]
  Course_Course_creatorIdToUser    Course[]               @relation("Course_creatorIdToUser")
  Course_Course_teacherIdToUser    Course[]               @relation("Course_teacherIdToUser")
  CourseReview                     CourseReview[]
  Enrollment                       Enrollment[]
  Message_Message_receiverIdToUser Message[]              @relation("Message_receiverIdToUser")
  Message_Message_senderIdToUser   Message[]              @relation("Message_senderIdToUser")
  Notification                     Notification[]
  Progress                         Progress[]
  StudyGroupMember                 StudyGroupMember[]
  Submission                       Submission[]
  User                             User?                  @relation("UserToUser", fields: [parentId], references: [id])
  other_User                       User[]                 @relation("UserToUser")

  @@index([email])
  @@index([role])
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}

enum AIInteractionType {
  QUESTION
  EXPLANATION
  EXAMPLE
  HINT
  FEEDBACK
  TRANSLATION
  SUMMARY
}

enum AchievementType {
  COURSE_COMPLETION
  STREAK
  PERFECT_SCORE
  EARLY_BIRD
  NIGHT_OWL
  HELPFUL_PEER
  MILESTONE
}

enum AssignmentType {
  ESSAY
  MULTIPLE_CHOICE
  SHORT_ANSWER
  PROJECT
  CODING
  PRESENTATION
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum CourseStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum EnrollmentStatus {
  ACTIVE
  COMPLETED
  DROPPED
  PAUSED
}

enum LearningStyle {
  VISUAL
  AUDITORY
  KINESTHETIC
  READING_WRITING
  MIXED
}

enum LessonType {
  VIDEO
  TEXT
  AUDIO
  INTERACTIVE
  QUIZ
  ASSIGNMENT
}

enum SubmissionStatus {
  DRAFT
  SUBMITTED
  GRADED
  RETURNED
}

enum UserRole {
  STUDENT
  TEACHER
  PARENT
  ADMIN
  CONTENT_CREATOR
}
